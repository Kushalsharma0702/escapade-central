import { CalendarDays, MapPin, Clock, Plane } from 'lucide-react';
import StatCard from '@/components/StatCard';
import StatusBadge from '@/components/StatusBadge';
import { bookings, travelPackages } from '@/data/mockData';
import { useAuth } from '@/contexts/AuthContext';
import { motion } from 'framer-motion';

export default function ClientDashboard() {
  const { user } = useAuth();
  const myBookings = bookings.filter(b => b.clientId === user?.id);
  const upcoming = myBookings.filter(b => b.status === 'approved');
  const pending = myBookings.filter(b => b.status === 'pending');

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-2xl font-bold text-foreground">Welcome back, {user?.name?.split(' ')[0]}!</h1>
        <p className="text-muted-foreground text-sm mt-1">Here's your travel overview</p>
      </div>

      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <StatCard title="Total Bookings" value={myBookings.length} icon={CalendarDays} variant="primary" />
        <StatCard title="Upcoming Trips" value={upcoming.length} icon={Plane} variant="accent" />
        <StatCard title="Pending" value={pending.length} icon={Clock} variant="warning" />
        <StatCard title="Destinations" value={new Set(myBookings.map(b => b.packageName)).size} icon={MapPin} variant="success" />
      </div>

      {/* Upcoming Trips */}
      {upcoming.length > 0 && (
        <div className="space-y-4">
          <h2 className="text-lg font-semibold text-foreground">Upcoming Trips</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {upcoming.map((b, i) => {
              const pkg = travelPackages.find(p => p.id === b.packageId);
              return (
                <motion.div key={b.id} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: i * 0.1 }}
                  className="bg-card rounded-xl border border-border/50 shadow-card overflow-hidden flex">
                  <div className="w-32 h-full">
                    <img src={pkg?.image} alt={b.packageName} className="w-full h-full object-cover" />
                  </div>
                  <div className="flex-1 p-4">
                    <h3 className="font-semibold text-card-foreground">{b.packageName}</h3>
                    <p className="text-xs text-muted-foreground mt-1">ðŸ“… {b.travelDate} Â· ðŸ‘¥ {b.travelers} travelers</p>
                    <div className="flex items-center justify-between mt-3">
                      <span className="text-sm font-bold text-primary">${b.totalAmount.toLocaleString()}</span>
                      <StatusBadge status={b.status} />
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      )}

      {/* All Bookings Summary */}
      <div className="space-y-4">
        <h2 className="text-lg font-semibold text-foreground">Booking History</h2>
        <div className="bg-card rounded-xl border border-border/50 shadow-card overflow-hidden">
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="border-b border-border/50">
                  {['Package', 'Date', 'Travelers', 'Amount', 'Status'].map(h => (
                    <th key={h} className="text-left text-xs font-medium text-muted-foreground px-6 py-3">{h}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {myBookings.map(b => (
                  <tr key={b.id} className="border-t border-border/30 hover:bg-muted/30 transition-colors">
                    <td className="px-6 py-4 text-sm font-medium text-card-foreground">{b.packageName}</td>
                    <td className="px-6 py-4 text-sm text-muted-foreground">{b.travelDate}</td>
                    <td className="px-6 py-4 text-sm text-card-foreground">{b.travelers}</td>
                    <td className="px-6 py-4 text-sm font-medium text-card-foreground">${b.totalAmount.toLocaleString()}</td>
                    <td className="px-6 py-4"><StatusBadge status={b.status} /></td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  );
}
